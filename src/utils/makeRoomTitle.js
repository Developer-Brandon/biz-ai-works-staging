/**
 * ëŒ€í™”ë°© ì œëª© ìƒì„± ìœ í‹¸
 *
 * ì—­í• :
 * - ì‚¬ìš©ì ì§ˆë¬¸ì—ì„œ ëŒ€í™”ë°© ì œëª© ìë™ ìƒì„±
 * - ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ì²˜ë¦¬ë¡œ ë¹ ë¥´ê³  ê°€ë²¼ì›€
 * - í•œê¸€/ì˜ë¬¸ ëª¨ë‘ ì§€ì›
 *
 * Vue2 vs Vue3:
 * - ìˆœìˆ˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ìœ í‹¸ì´ë¯€ë¡œ ë™ì¼
 *
 * @param {string} text - ì›ë³¸ í…ìŠ¤íŠ¸ (ì‚¬ìš©ì ì§ˆë¬¸)
 * @returns {string} ìƒì„±ëœ ëŒ€í™”ë°© ì œëª©
 *
 * @example
 * makeRoomTitle("ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì–´ë•Œ?")
 * // â†’ "ì˜¤ëŠ˜ ë‚ ì”¨"
 *
 * makeRoomTitle("What is machine learning?")
 * // â†’ "What is machine"
 */
export function makeRoomTitle(text) {
  if (!text) return "ìƒˆ ëŒ€í™”";

  console.group("ğŸ¯ [ëŒ€í™”ë°© ì œëª© ìƒì„±]");
  console.log("ì›ë³¸ í…ìŠ¤íŠ¸:", text);

  // ============================================================
  // 1ï¸âƒ£ ê³µë°±ê³¼ íŠ¹ìˆ˜ë¬¸ì ì œê±°
  // ============================================================
  const trimmedText = text.trim();

  if (!trimmedText) {
    console.log("ê²°ê³¼: ë¹ˆ í…ìŠ¤íŠ¸ â†’ 'ìƒˆ ëŒ€í™”' ë°˜í™˜");
    console.groupEnd();
    return "ìƒˆ ëŒ€í™”";
  }

  // ============================================================
  // 2ï¸âƒ£ ë¬¸ì¥ë¶€í˜¸ ì œê±° (ë§ˆì¹¨í‘œ, ë¬¼ìŒí‘œ, ëŠë‚Œí‘œ ë“±)
  // ============================================================
  const cleanedText = trimmedText
    .replace(/[?!.;:,à¥¤ã€]/g, "") // ë¬¸ì¥ë¶€í˜¸ ì œê±°
    .trim();

  if (!cleanedText) {
    console.log("ê²°ê³¼: ë¬¸ì¥ë¶€í˜¸ë§Œ ìˆìŒ â†’ 'ìƒˆ ëŒ€í™”' ë°˜í™˜");
    console.groupEnd();
    return "ìƒˆ ëŒ€í™”";
  }

  // ============================================================
  // 3ï¸âƒ£ ë‹¨ì–´ ë¶„ë¦¬ (ê³µë°± ê¸°ì¤€)
  // ============================================================
  const words = cleanedText.split(/\s+/);

  console.log("ë¶„ë¦¬ëœ ë‹¨ì–´:", words);

  // ============================================================
  // 4ï¸âƒ£ ë¶ˆí•„ìš”í•œ ë‹¨ì–´ í•„í„°ë§ (ì¡°ì‚¬, ë™ì‚¬ ë“±)
  // ============================================================
  //
  // ì œì™¸í•  ë‹¨ì–´ ëª©ë¡:
  // - í•œê¸€ ì¡°ì‚¬: ì´, ê°€, ì„, ë¥¼, ì—, ëŠ”, ê³ , ìœ¼ë¡œ
  // - ì˜ë¬¸ ê´€ê³„ì‚¬: is, are, am, do, does, did, be, the, a, an, of
  //

  const excludeWords = new Set([
    // í•œê¸€ ì¡°ì‚¬ & ë™ì‚¬
    "ì´",
    "ê°€",
    "ì„",
    "ë¥¼",
    "ì—",
    "ëŠ”",
    "ê³ ",
    "ìœ¼ë¡œ",
    "ì™€",
    "ë„",
    "ë§Œ",
    "ê¹Œì§€",
    "ë¶€í„°",
    "ì˜",
    "ì—ê²Œ",
    // ì˜ë¬¸
    "is",
    "are",
    "am",
    "do",
    "does",
    "did",
    "be",
    "been",
    "the",
    "a",
    "an",
    "of",
    "in",
    "on",
    "at",
    "to",
    "for",
    "and",
    "or",
    "but",
    "what",
    "how",
    "why",
  ]);

  const meaningfulWords = words.filter(
    (word) =>
      word.length > 0 && // ë¹ˆ ë¬¸ìì—´ ì œê±°
      !excludeWords.has(word.toLowerCase()) && // ë¶ˆí•„ìš”í•œ ë‹¨ì–´ ì œê±°
      word.length > 1 // 1ê¸€ì ë‹¨ì–´ ì œê±° (ë„ˆë¬´ ì§§ìŒ)
  );

  console.log("ì˜ë¯¸ìˆëŠ” ë‹¨ì–´:", meaningfulWords);

  // ============================================================
  // 5ï¸âƒ£ ìµœëŒ€ 3ê°œ ë‹¨ì–´ë¡œ ì œí•œ
  // ============================================================
  //
  // ì œëª©ì€ ë„ˆë¬´ ê¸¸ë©´ ì•ˆ ë˜ë¯€ë¡œ ìµœëŒ€ 3ê°œ ë‹¨ì–´ë§Œ ì‚¬ìš©
  //

  const titleWords = meaningfulWords.slice(0, 3);

  // ============================================================
  // 6ï¸âƒ£ ê²°ê³¼ ìƒì„±
  // ============================================================
  const title =
    titleWords.length > 0 ? titleWords.join(" ") : trimmedText.slice(0, 15); // fallback: ì• 15ê¸€ì

  console.log("ìƒì„±ëœ ì œëª©:", title);
  console.groupEnd();

  return title + "..."; // ì œëª© ëì— "..." ì¶”ê°€
}
